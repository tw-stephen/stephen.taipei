<section id="experience" #experienceSection class="relative">
  <div class="container mx-auto">
    <!-- Section Header -->
    <div class="text-center mb-12 md:mb-16">
      <h2 class="section-title animate-on-scroll">
        <span class="text-gradient">工作經歷</span>
      </h2>
      <p class="section-subtitle animate-on-scroll">Work Experience</p>
    </div>

    <!-- Timeline Container -->
    <div class="timeline max-w-4xl mx-auto relative">
      <!-- Timeline Line -->
      <div class="absolute left-4 lg:left-1/2 top-0 bottom-0 w-px bg-gradient-to-b from-primary via-secondary to-primary/20 lg:-translate-x-px"></div>

      @for (exp of experiences; track exp.id; let i = $index; let odd = $odd) {
        <div class="timeline-item relative mb-10 lg:mb-16">
          <!-- Timeline Dot -->
          <div
            class="absolute left-4 lg:left-1/2 w-3 h-3 rounded-full -translate-x-1/2 z-10 border-2"
            [class.bg-primary]="exp.current"
            [class.border-primary]="exp.current"
            [class.bg-dark]="!exp.current"
            [class.border-muted]="!exp.current"
          ></div>

          <!-- Content Card -->
          <div
            class="ml-10 lg:ml-0 card p-5 md:p-6 cursor-pointer"
            (click)="toggleExpand(exp.id)"
          >
            <!-- Header -->
            <div class="flex flex-wrap items-center gap-2 mb-3">
              <!-- Period Badge -->
              <span
                class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium"
                [class.bg-primary/10]="exp.current"
                [class.text-primary]="exp.current"
                [class.bg-muted/10]="!exp.current"
                [class.text-muted]="!exp.current"
              >
                @if (exp.current) {
                  <span class="w-1.5 h-1.5 bg-accent rounded-full animate-pulse"></span>
                }
                {{ exp.period }}
              </span>
            </div>

            <!-- Company & Position -->
            <h3 class="text-lg md:text-xl font-bold text-light mb-1">{{ exp.company }}</h3>
            <p class="text-primary font-medium mb-3">{{ exp.position }}</p>

            <!-- Description -->
            <p class="text-muted text-sm md:text-base mb-4 leading-relaxed">{{ exp.description }}</p>

            <!-- Expandable Content -->
            @if (isExpanded(exp.id)) {
              <div class="animate-fade-in-up">
                <!-- Achievements -->
                <div class="mb-4">
                  <h4 class="text-sm font-semibold text-light mb-2 flex items-center gap-2">
                    <svg class="w-4 h-4 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    主要成就
                  </h4>
                  <ul class="space-y-2">
                    @for (achievement of exp.achievements; track achievement) {
                      <li class="text-muted text-sm flex items-start gap-2">
                        <span class="text-primary mt-1">-</span>
                        <span>{{ achievement }}</span>
                      </li>
                    }
                  </ul>
                </div>

                <!-- Technologies -->
                <div class="flex flex-wrap gap-2">
                  @for (tech of exp.technologies; track tech) {
                    <span class="tag">{{ tech }}</span>
                  }
                </div>
              </div>
            }

            <!-- Expand Indicator -->
            <div class="flex items-center gap-1 mt-4 text-muted text-sm">
              <span>{{ isExpanded(exp.id) ? '收起' : '展開詳情' }}</span>
              <svg
                class="w-4 h-4 transition-transform duration-200"
                [class.rotate-180]="isExpanded(exp.id)"
                fill="none" stroke="currentColor" viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</section>
